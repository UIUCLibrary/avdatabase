{% from "_macros.html" import notes_table_head, notes_table_row, notes_new_button_row, note_editor_events %}
{% extends "details_table.html" %}
{% block detail_table -%}
<div class="card my-1">
    <div class="card-body">
        <table class="table">
            <tbody>
                {%- for field in fields %}
                <tr>
                    <td style="width: 16.66%" class="font-weight-bold">{{field.name}}</td>
                    <td>
                        <div id="{{field.name}}Label">
                            {{-project.get(field.key) or ""-}}
                        </div>
                        <div id="{{field.key}}InputGroup" class="input-group" hidden>
                        {% if field.editable -%}
                        <label for="{{field.key}}Input"></label>
                        <input id="{{field.key}}Input" type="text" class="form-control" value="{{-project.get(field.key) or ""-}}"/>
                        <div class="input-group-append">
                            <button id="{{field.key}}Confirm"
                                    onclick="confirmUpdate('{{ api_path }}', '{{field.key}}')"
                                    class="btn btn-outline-secondary">Confirm</button>
                            {%- endif %}
                            </div>
                        </div>
                    </td>
                    <td style="width: 5%">
                        {%- if field.editable -%}
                        <button id="editButton{{loop.index}}" class="btn btn-secondary float-right btn-sm">Edit</button>
                        <script>
                            document.getElementById("editButton{{loop.index}}").onclick = function (){
                                flipMode(
                                    "{{field.name}}Label",
                                    "{{field.key}}InputGroup",
                                    "{{field.key}}Input",
                                    "{{-project.get(field.key) or ""-}}",
                                    "editButton{{loop.index}}"
                                )
                            };
                            document.getElementById("{{field.key}}Input").addEventListener('keypress', (e) => {
                                if (e.key === "Enter") {
                                    document.getElementById("{{field.key}}Confirm").click();
                                }
                            });
                        </script>
                    </td>
                {% endif -%}
                </tr>
                {%- endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="card my-1">
    <div class="card-header">
        <h5 class="card-title">Objects</h5>
    </div>
    <div class="card-body">
        <table class="table">
            <tbody>
                {%- for child_object in project['objects'] %}
                <tr>
                    <td><a href="{{ url_for('page_projects')}}/{{ project_id }}/object/{{ child_object['object_id'] }}"> {{ child_object['name'] }}</a></td>
                    <td><button class="float-right btn btn-danger btn-sm" disabled>Remove</button></td>
                </tr>
                {%- endfor %}
                <tr>
                    <td></td>
                    <td>
                        <div class="btn-group float-right" role="group">
                            <button class="btn btn-primary btn-sm" disabled>Add</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="card">
    <h5 class="card-header">Notes</h5>
    <div class="card-body">
        <table class="table">
            {{ notes_table_head(project['notes']) }}
            <tbody>
                {%- for note in project['notes'] %}
                    {{ notes_table_row(note, api_path + "/notes/" ~ note['note_id'] ) }}
                {% endfor -%}
                {{ notes_new_button_row(api_path) }}
            </tbody>
        </table>
    </div>
</div>
{%- endblock -%}
{% block scripts %}
    {{ super() }}
    {{ note_editor_events(api_path, valid_note_types) }}
{% endblock %}